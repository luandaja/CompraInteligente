@model CompraInteligente.Models.Simulador
@using CompraInteligente.Controllers

@{ 
    int n = 0;
}
<table class="table">
    <tr>
        <th>
           #
        </th>
        <th>
            Fecha
        </th>
        <th>
            Saldo
        </th>
        <th>
            Interés
        </th>
        <th>
            Seguro Desgr
        </th>
        <th>
            Seguro Bien
        </th>
        <th>
            Amortización
        </th>
        <th>
            Envío de Información Periódica 
        </th>
        <th>
            Cuota
        </th>
        <th></th>
    </tr>
    @{ 
        DateTime fecha = Model.fechaDesenbolso;
        double monto = Model.montoDelPrestamo_num;
        double cuotaTotal = 0;
        double cuotaMensual = 0;
        double interes = 0;
        double amortizacion = 0;
        double segurodesg = 0;
        double segurodelBien= 0;
    }
    @for (int i = 0; i < Model.plazo + 2; i++)
    {

        <tr>
            @{
                if (i!=0)
                {
                    //calcular montos no tasas!!!
                    cuotaMensual = ((SimuladorsController)this.ViewContext.Controller).calcularCuotaMensual(Model, monto, DateTime.DaysInMonth(fecha.Year, fecha.Month));
                    interes = ((SimuladorsController)this.ViewContext.Controller).calcularInteres(Model, monto, DateTime.DaysInMonth(fecha.Year, fecha.Month));
                    amortizacion = ((SimuladorsController)this.ViewContext.Controller).calcularAmortizacion(cuotaMensual, interes);
                    segurodesg = ((SimuladorsController)this.ViewContext.Controller).calcularTasaAjustadaSeguroDesgravamen(Model, DateTime.DaysInMonth(fecha.Year, fecha.Month));
                    segurodesg = monto * segurodesg;
                    segurodelBien = ((SimuladorsController)this.ViewContext.Controller).calcularTasaAjustadaSeguroVehicular(Model, DateTime.DaysInMonth(fecha.Year, fecha.Month));
                    cuotaTotal = interes + segurodesg + tasaseguroV + amortizacion + Model.portes;

                }
                else
                {
                    cuotaTotal = 0;
                }
                fecha = fecha.AddMonths(1);
            }
            <td>
                @i
            </td>
            <td>
                @fecha
                
            </td>
            <td>
                @monto
                @{ 
                    monto -= amortizacion;
                }
            </td>
            <td>
                @interes
            </td>
            <td>
               @segurodesg

            </td>
            <td>
                @tasaseguroV
            </td>
            <td>
                @amortizacion
            </td>
            <td>
                @Model.portes
            </td>
            <td>
                @cuotaTotal
            </td>
            
            <td>
                @Html.ActionLink("Volver", "Index")
            </td>
        </tr>
        
    }

</table>

